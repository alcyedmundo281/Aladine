<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Protocolos Médicos - HECAM</title>
    <!-- Hoja de estilos -->
    <link rel="stylesheet" href="style.css">
    <style>
      /* Barra de progreso para descarga de modelo local */
      .progress { display:flex; width:100%; height:10px; background:#eee; border-radius:6px; overflow:hidden; margin-top:8px; }
      .progress-bar { width:0%; background:#28a745; transition:width .2s ease; }
      .hint { font-size:13px; color:#555; margin-top:6px; }
      .warn { background:#fff3cd; border-left:5px solid #ffec99; padding:10px; border-radius:4px; margin-top:8px; }
      .muted { color:#666; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <img src="https://www.iess.gob.ec/documents/10162/34411/hcam.png/267d605c-3a3f-42ba-81f1-30de6da52528?t=1432240905000" alt="Logo HECAM" class="logo">
            <h1>Generador Avanzado de Protocolos Médicos</h1>
            <p>Una herramienta para estandarizar la atención en el HECAM</p>
        </header>
        
        <main>
            <div class="input-section">
                <label for="protocolTitle">1. Ingrese el título del protocolo:</label>
                <input type="text" id="protocolTitle" placeholder="Ej: Manejo de la Sepsis en Adultos">

                <label for="medicalUnit">2. Seleccione la Unidad Médica responsable:</label>
                <select id="medicalUnit">
                    <option value="Medicina Interna">Medicina Interna</option>
                    <option value="Neurología">Neurología</option>
                    <option value="Gastroenterología">Gastroenterología</option>
                    <option value="Traumatología">Traumatología</option>
                    <option value="Cardiología">Cardiología</option>
                    <option value="Neumología">Neumología</option>
                    <option value="Cirugía General">Cirugía General</option>
                </select>

                <label for="engine">3. Motor de generación:</label>
                <select id="engine">
                    <option value="gemini">Gemini (API)</option>
                    <option value="local">Local (WebGPU)</option>
                    <option value="demo">Demo (sin modelo)</option>
                </select>
                <label class="remember-row" style="display:flex;gap:8px;align-items:center;margin-top:6px;">                    <input type="checkbox" id="rememberEngine">
                    <span>Recordar mi elección de motor</span>
                </label>

                <label for="apiKey">4. (Opcional) Clave API de Google Gemini:</label>
                <input type="password" id="apiKey" placeholder="Solo si eliges Gemini">
                <div class="api-warning"><strong>Nota:</strong> Para <em>Local (WebGPU)</em> no necesitas API. La primera carga descargará el modelo y quedará cacheado.</div>
                <div id="compatWarning" class="warn" style="display:none;"></div>
                <button id="generateButton">1. Generar Estructura</button>
                <div id="modelStatus" class="api-warning" style="display:none;"></div>
                <div id="modelProgressWrap" class="progress" style="display:none;"><div id="modelProgressBar" class="progress-bar"></div></div>
                <div id="modelHint" class="hint muted" style="display:none;"></div>
            </div>
            <div class="loader" id="loader" style="display: none;"></div>
            <div id="protocolStructure" class="protocol-structure-container"></div>
            <div id="actionButtons" class="action-buttons-container"></div>
            <div id="protocolOutput" class="protocol-container" style="display: none;"></div>
        </main>
    </div>

    <!-- Bibliotecas de terceros -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: false });
        window.mermaid = mermaid;
        // Importa WebLLM solo cuando sea necesario
        import * as webllm from "https://esm.run/@mlc-ai/web-llm";
        window.webllm = webllm;
    </script>
    <!-- Lógica de la aplicación -->
    <script src="script.js"></script>
</body>
</html>
